<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lock Puzzle Game - AI Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <style>
        body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
         @keyframes pulse {
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // --- Icon Components ---
        const Lock = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const Check = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20,6 9,17 4,12"/></svg>;
        const X = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>;
        const RotateCcw = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const Shuffle = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="16,3 21,3 21,8"/><path d="M4 20 21 3"/><polyline points="21,16 21,21 16,21"/><path d="M15 15 21 21"/><path d="M4 4 9 9"/></svg>;
        const Trophy = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55.47.98.97 1.21C12.04 18.75 13 20.24 13 22"/><path d="M14 14.66V17c0 .55-.47.98-.97 1.21C11.96 18.75 11 20.24 11 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const User = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Sparkles = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>;

        const LockPuzzleGame = () => {
            const [playerName, setPlayerName] = useState('');
            const [isNameSet, setIsNameSet] = useState(false);
            const [userGuess, setUserGuess] = useState(['', '', '']);
            const [attempts, setAttempts] = useState([]);
            const [isComplete, setIsComplete] = useState(false);
            const [showHint, setShowHint] = useState(false);
            const [currentPuzzle, setCurrentPuzzle] = useState(null);
            const [puzzleNumber, setPuzzleNumber] = useState(1);
            const [showLeaderboard, setShowLeaderboard] = useState(false);
            const [leaderboard, setLeaderboard] = useState([]);
            const [startTime, setStartTime] = useState(null);

            // AI Hint State
            const [aiHint, setAiHint] = useState('');
            const [isHintLoading, setIsHintLoading] = useState(false);
            
            // Firebase State
            const [db, setDb] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [isOnlineMode, setIsOnlineMode] = useState(true); // Track online status

            // --- Firebase Initialization and Auth ---
            useEffect(() => {
                // This placeholder will be replaced by the GitHub Action with a JSON string.
                const firebaseConfigJSON = `__FIREBASE_CONFIG_JSON_PLACEHOLDER__`;
                let firebaseConfig = {};

                try {
                    if (firebaseConfigJSON.startsWith("__FIREBASE")) {
                        throw new Error("Placeholder not replaced");
                    }
                    // Safely parse the JSON string. This prevents syntax errors.
                    firebaseConfig = JSON.parse(firebaseConfigJSON);
                } catch (e) {
                    console.warn("Could not parse Firebase config. Running in offline mode.", e.message);
                    setIsOnlineMode(false);
                    setIsAuthReady(true);
                    return;
                }

                try {
                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                    }
                    setDb(firebase.firestore());

                    const auth = firebase.auth();
                    const unsubscribe = auth.onAuthStateChanged(async (user) => {
                        if (!user) {
                           try {
                                await auth.signInAnonymously();
                            } catch (error) {
                                console.error("Firebase sign-in failed:", error);
                                setIsOnlineMode(false);
                            }
                        }
                        setIsAuthReady(true);
                    });
                    return () => unsubscribe();
                } catch (e) {
                    console.error("Error initializing Firebase:", e);
                    setIsOnlineMode(false);
                    setIsAuthReady(true);
                }
            }, []);

            // --- Real-time Leaderboard Listener ---
            useEffect(() => {
                if (!isAuthReady || !db || !isOnlineMode) return;
                
                const appId = 'lock-puzzle-game'; 
                const leaderboardPath = `artifacts/${appId}/public/data/leaderboard`;

                const unsubscribe = db.collection(leaderboardPath).onSnapshot(snapshot => {
                    const leaderboardData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const sortedLeaderboard = leaderboardData
                        .sort((a, b) => b.score - a.score)
                        .slice(0, 20);
                    setLeaderboard(sortedLeaderboard);
                }, error => {
                    console.error("Error fetching leaderboard: ", error);
                });

                return () => unsubscribe();
            }, [isAuthReady, db, isOnlineMode]);

            // --- Game Logic (unchanged) ---
            const generateRandomAnswer = () => Array.from({length: 3}, () => Math.floor(Math.random() * 10).toString());
            const generateRandomCombination = (answer) => {
                let combo;
                do { combo = generateRandomAnswer(); } while (combo.join('') === answer.join(''));
                return combo;
            };
            const analyzeClue = (combination, answer) => {
                let correctPosition = 0;
                let correctDigitWrongPosition = 0;
                let usedAnswerIndices = [];
                let usedComboIndices = [];
                for (let i = 0; i < 3; i++) {
                    if (combination[i] === answer[i]) {
                        correctPosition++;
                        usedAnswerIndices.push(i);
                        usedComboIndices.push(i);
                    }
                }
                for (let i = 0; i < 3; i++) {
                    if (!usedComboIndices.includes(i)) {
                        for (let j = 0; j < 3; j++) {
                            if (!usedAnswerIndices.includes(j) && combination[i] === answer[j]) {
                                correctDigitWrongPosition++;
                                usedAnswerIndices.push(j);
                                break;
                            }
                        }
                    }
                }
                return { correctPosition, correctDigitWrongPosition };
            };
            const generateClueDescription = (analysis) => {
                const { correctPosition, correctDigitWrongPosition } = analysis;
                if (correctPosition === 0 && correctDigitWrongPosition === 0) return { hint: 'Ù„Ø§ Ø´ÙŠØ¡ ØµØ­ÙŠØ­', translation: 'Nothing is correct' };
                if (correctPosition === 1 && correctDigitWrongPosition === 0) return { hint: 'Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­ ÙˆÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­', translation: 'One digit correct and in right place' };
                if (correctPosition === 0 && correctDigitWrongPosition === 1) return { hint: 'Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­ ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'One digit correct but in wrong place' };
                if (correctPosition === 0 && correctDigitWrongPosition === 2) return { hint: 'Ø±Ù‚Ù…Ø§Ù† ØµØ­ÙŠØ­Ø§Ù† ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'Two digits correct but in wrong place' };
                if (correctPosition === 1 && correctDigitWrongPosition === 1) return { hint: 'Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­ ÙˆÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­ØŒ ÙˆØ±Ù‚Ù… Ø¢Ø®Ø± ØµØ­ÙŠØ­ ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'One correct and in right place, one correct but in wrong place' };
                if (correctPosition === 2 && correctDigitWrongPosition === 0) return { hint: 'Ø±Ù‚Ù…Ø§Ù† ØµØ­ÙŠØ­Ø§Ù† ÙˆÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­', translation: 'Two digits correct and in right place' };
                if (correctPosition === 0 && correctDigitWrongPosition === 3) return { hint: 'ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø© ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'All digits correct but in wrong places' };
                return { hint: 'ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ù‚Ø¯', translation: 'Complex analysis' };
            };
            const generatePuzzle = () => {
                const answer = generateRandomAnswer();
                const clues = [];
                const createdAnalyses = new Set();
                
                while (clues.length < 5) {
                    let combination = generateRandomCombination(answer);
                    let analysis = analyzeClue(combination, answer);
                    let analysisKey = `${analysis.correctPosition}-${analysis.correctDigitWrongPosition}`;

                    if (!createdAnalyses.has(analysisKey) || clues.length >= 4) { // Get more variety
                        const clueDesc = generateClueDescription(analysis);
                        clues.push({ digits: combination, hint: clueDesc.hint, translation: clueDesc.translation });
                        createdAnalyses.add(analysisKey);
                    }
                }
                return { answer: answer, clues: clues.sort(() => Math.random() - 0.5) }; // Shuffle clues
            };

            useEffect(() => {
                if (isNameSet && !currentPuzzle) {
                    setCurrentPuzzle(generatePuzzle());
                    setStartTime(Date.now());
                }
            }, [isNameSet, currentPuzzle]);

            // --- Game Actions ---
            const generateNewPuzzle = () => {
                setCurrentPuzzle(generatePuzzle());
                setPuzzleNumber(prev => prev + 1);
                setUserGuess(['', '', '']);
                setAttempts([]);
                setIsComplete(false);
                setShowHint(false);
                setAiHint('');
                setStartTime(Date.now());
            };
            
            const calculateScore = (attemptCount, timeInSeconds) => {
                const baseScore = 1000;
                const attemptPenalty = attemptCount * 50;
                const timePenalty = Math.floor(timeInSeconds / 10) * 5;
                return Math.max(100, baseScore - attemptPenalty - timePenalty);
            };

            const addToLeaderboard = async (score, timeInSeconds) => {
                if (!db || !isOnlineMode) return;
                const appId = 'lock-puzzle-game';
                const leaderboardPath = `artifacts/${appId}/public/data/leaderboard`;
                
                const newEntry = {
                    name: playerName,
                    score: score,
                    attempts: attempts.length + 1,
                    time: timeInSeconds,
                    puzzle: puzzleNumber,
                    timestamp: new Date().toISOString()
                };

                try {
                    await db.collection(leaderboardPath).add(newEntry);
                } catch (error) {
                    console.error("Error adding to leaderboard:", error);
                }
            };
            
            const handleDigitChange = (index, value) => {
                if (value.length <= 1 && /^[0-9]*$/.test(value)) {
                    const newGuess = [...userGuess];
                    newGuess[index] = value;
                    setUserGuess(newGuess);
                }
            };

            const checkAnswer = () => {
                if (!currentPuzzle || userGuess.some(digit => digit === '')) return;
                const isCorrect = userGuess.join('') === currentPuzzle.answer.join('');
                
                const newAttempt = { guess: [...userGuess], correct: isCorrect, timestamp: new Date().toLocaleTimeString() };
                const updatedAttempts = [...attempts, newAttempt];
                setAttempts(updatedAttempts);
                
                if (isCorrect) {
                    setIsComplete(true);
                    const timeInSeconds = Math.floor((Date.now() - startTime) / 1000);
                    const score = calculateScore(updatedAttempts.length, timeInSeconds);
                    addToLeaderboard(score, timeInSeconds);
                }
            };

            const resetGame = () => {
                setUserGuess(['', '', '']);
                setAttempts([]);
                setIsComplete(false);
                setShowHint(false);
                setAiHint('');
                setStartTime(Date.now());
            };

            const handleNameSubmit = (e) => {
                e.preventDefault();
                if (playerName.trim()) {
                    setIsNameSet(true);
                }
            };

            // --- AI Hint Generation ---
            const getAiHint = async () => {
                if (isHintLoading || !currentPuzzle) return;
                setShowHint(true);
                setAiHint('');
                setIsHintLoading(true);

                const systemPrompt = "You are a master puzzle solver for a logic game called 'Lock Puzzle'. Your goal is to give a single, clever, deductive hint to the player to help them solve a 3-digit code. Do not reveal the answer or any specific digits of the answer. The hint should be based on the provided clues and the player's previous guesses. The hint must be in Arabic, followed by an English translation separated by ' / '. For example: 'ÙÙƒØ± ÙÙŠ Ø§Ù„Ù‚Ø±ÙŠÙ†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© ÙˆÙ…Ø­Ø§ÙˆÙ„ØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø±Ù‚Ù… Ù…Ø¹ÙŠÙ†. / Based on the third clue and your last attempt, you can eliminate a certain number.'";
                const cluesText = currentPuzzle.clues.map((c, i) => `Clue ${i+1}: Combination ${c.digits.join('')} -> ${c.translation}`).join('\n');
                const attemptsText = attempts.length > 0 ? attempts.map((a, i) => `Attempt ${i+1}: ${a.guess.join('')}`).join('\n') : "No attempts yet.";
                const userQuery = `Here is the puzzle information:\n\nClues:\n${cluesText}\n\nMy previous attempts:\n${attemptsText}\n\nBased on all this information, give me one logical hint to guide my next guess.`;
                
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    let response;
                    let delay = 1000;
                    for (let i = 0; i < 5; i++) { // Retry with exponential backoff
                        response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (response.ok) break;
                        if (response.status === 429 || response.status >= 500) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                        } else { break; }
                    }
                    if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
                    
                    const result = await response.json();
                    const hintText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    setAiHint(hintText || "Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ ØªÙ„Ù…ÙŠØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. / Could not generate a hint. Please try again.");
                } catch (error) {
                    console.error("AI Hint Error:", error);
                    setAiHint("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ„Ù…ÙŠØ­. / An error occurred while fetching the hint.");
                } finally {
                    setIsHintLoading(false);
                }
            };
            
            // --- UI Rendering ---
            if (!isAuthReady) {
                 return <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4 text-white text-xl">Loading Game...</div>;
            }

            if (!isNameSet) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
                            <div className="flex justify-center mb-6"><div className="bg-slate-700 p-4 rounded-full"><User size={48} className="text-white" /></div></div>
                            <h1 className="text-2xl font-bold text-slate-800 mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚ÙÙ„</h1>
                            <p className="text-slate-600 mb-6">Welcome to Lock Puzzle Game</p>
                            <form onSubmit={handleNameSubmit}>
                                <input type="text" value={playerName} onChange={(e) => setPlayerName(e.target.value)} placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ / Enter your name" className="w-full px-4 py-3 text-center border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none mb-4 text-lg" maxLength="20" />
                                <button type="submit" disabled={!playerName.trim()} className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-3 rounded-lg font-semibold text-lg transition-colors">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ / Start Playing</button>
                            </form>
                            <button onClick={() => setShowLeaderboard(true)} className="mt-4 text-blue-600 hover:text-blue-800 text-sm underline flex items-center justify-center gap-2 mx-auto disabled:text-gray-400 disabled:cursor-not-allowed" disabled={!isOnlineMode}>
                                <Trophy size={16} />
                                {isOnlineMode ? 'Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† / View Leaderboard' : 'Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† (ØºÙŠØ± Ù…ØªØµÙ„) / Leaderboard (Offline)'}
                            </button>
                        </div>
                    </div>
                );
            }

            if (showLeaderboard) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full">
                            <div className="text-center mb-6">
                                <div className="flex justify-center mb-4"><div className="bg-yellow-500 p-4 rounded-full"><Trophy size={48} className="text-white" /></div></div>
                                <h1 className="text-2xl font-bold text-slate-800 mb-2">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† / Leaderboard</h1>
                            </div>
                            <div className="max-h-96 overflow-y-auto mb-6">
                                {leaderboard.length === 0 ? <p className="text-center text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯ / No results yet</p> :
                                    leaderboard.map((entry, index) => (
                                        <div key={entry.id} className={`flex items-center justify-between p-3 rounded-lg mb-2 ${index < 3 ? 'bg-gradient-to-r from-yellow-50 to-yellow-100 border-2 border-yellow-200' : 'bg-slate-50'}`}>
                                            <div className="flex items-center gap-3">
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold ${index === 0 ? 'bg-yellow-500' : index === 1 ? 'bg-gray-400' : index === 2 ? 'bg-yellow-600' : 'bg-slate-400'}`}>{index + 1}</div>
                                                <div>
                                                    <p className="font-semibold text-slate-800">{entry.name}</p>
                                                    <p className="text-xs text-slate-500">{`Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${entry.attempts} | Ø§Ù„ÙˆÙ‚Øª: ${entry.time}Ø« | Ø§Ù„Ù„ØºØ²: ${entry.puzzle}`}</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-bold text-lg text-blue-600">{entry.score}</p>
                                                <p className="text-xs text-slate-500">{new Date(entry.timestamp).toLocaleString()}</p>
                                            </div>
                                        </div>
                                    ))
                                }
                            </div>
                            <button onClick={() => setShowLeaderboard(false)} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø© / Back to Game</button>
                        </div>
                    </div>
                );
            }

            if (!currentPuzzle) {
                return <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center"><div className="text-white text-xl">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù„ØºØ²... / Loading puzzle...</div></div>;
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <div className="text-center mb-8">
                            <div className="flex justify-center mb-4"><div className="bg-slate-700 p-4 rounded-full"><Lock size={48} className="text-white" /></div></div>
                            <h1 className="text-2xl font-bold text-slate-800 mb-2">Ù‡Ù„ ØªØ³ØªØ·ÙŠØ¹ ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ØŸ</h1>
                            <p className="text-slate-600">Can you open the lock?</p>
                            <div className="bg-blue-50 rounded-lg p-2 mt-3">
                                <p className="text-blue-800 font-semibold">{`ğŸ® Ø§Ù„Ù„Ø§Ø¹Ø¨: ${playerName} | Player: ${playerName}`}</p>
                                <p className="text-blue-600 text-sm">{`Ù„ØºØ² Ø±Ù‚Ù… ${puzzleNumber} | Puzzle #${puzzleNumber}`}</p>
                            </div>
                        </div>

                        <div className="mb-6">
                            <div className="flex justify-center gap-4 mb-4">
                                {userGuess.map((digit, index) => <input key={index} type="text" value={digit} onChange={(e) => handleDigitChange(index, e.target.value)} className="w-16 h-16 text-2xl font-bold text-center border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none" maxLength="1" disabled={isComplete} />)}
                            </div>
                            <div className="flex gap-2 justify-center flex-wrap">
                                <button onClick={checkAnswer} disabled={userGuess.some(d => d === '') || isComplete} className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg font-semibold transition-colors">ØªØ­Ù‚Ù‚ / Check</button>
                                <button onClick={resetGame} className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors"><RotateCcw size={20} /></button>
                                <button onClick={generateNewPuzzle} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2"><Shuffle size={16} /><span className="text-sm">Ù„ØºØ² Ø¬Ø¯ÙŠØ¯</span></button>
                                <button onClick={() => setShowLeaderboard(true)} className="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled={!isOnlineMode}>
                                    <Trophy size={16} />
                                    <span className="text-sm">{isOnlineMode ? 'Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†' : 'ØºÙŠØ± Ù…ØªØµÙ„'}</span>
                                </button>
                            </div>
                        </div>

                        {isComplete &&
                            <div className="bg-green-100 border-2 border-green-400 rounded-lg p-4 mb-6 text-center">
                                <Check className="mx-auto mb-2 text-green-600" size={32} />
                                <p className="text-green-800 font-bold">ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙØªØ­Øª Ø§Ù„Ù‚ÙÙ„!</p>
                                <p className="text-green-700">Congratulations! You opened the lock!</p>
                                <p className="text-green-600 text-sm mt-2">{`Ø§Ù„Ø¬ÙˆØ§Ø¨ ÙƒØ§Ù†: ${currentPuzzle.answer.join('')} / Answer was: ${currentPuzzle.answer.join('')}`}</p>
                                <p className="text-blue-600 text-sm mt-1 font-semibold">{`Ù†Ù‚Ø§Ø·Ùƒ: ${calculateScore(attempts.length, Math.floor((Date.now() - startTime) / 1000))}`}</p>
                            </div>
                        }

                        <div className="mb-6">
                            <h3 className="text-lg font-bold text-slate-800 mb-4 text-center">Ø§Ù„Ù‚Ø±Ø§Ø¦Ù† / Clues</h3>
                            <div className="space-y-3">
                                {currentPuzzle.clues.map((clue, index) =>
                                    <div key={index} className="bg-slate-50 rounded-lg p-3">
                                        <div className="flex justify-center gap-2 mb-2">
                                            {clue.digits.map((digit, i) => <div key={i} className="w-10 h-10 bg-white border-2 border-slate-300 rounded flex items-center justify-center font-bold text-slate-700">{digit}</div>)}
                                        </div>
                                        <p className="text-sm text-slate-600 text-center font-semibold">{clue.hint}</p>
                                        <p className="text-xs text-slate-500 text-center">{clue.translation}</p>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        {attempts.length > 0 &&
                            <div className="mb-4">
                                <h3 className="text-lg font-bold text-slate-800 mb-2">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª / Attempts</h3>
                                <div className="space-y-2 max-h-32 overflow-y-auto p-2 bg-gray-50 rounded-md">
                                    {attempts.slice().reverse().map((attempt, index) =>
                                        <div key={index} className="flex items-center justify-between text-sm">
                                            <div className="flex items-center gap-2">
                                               <span className="text-xs text-gray-400">#{attempts.length - index}</span>
                                               <div className="flex gap-1 font-mono tracking-widest">{attempt.guess.join('')}</div>
                                               {attempt.correct ? <Check size={16} className="text-green-600" /> : <X size={16} className="text-red-600" />}
                                            </div>
                                            <span className="text-slate-500 text-xs">{attempt.timestamp}</span>
                                        </div>
                                    )}
                                </div>
                            </div>
                        }
                        
                        <div className="text-center border-t pt-4 mt-4">
                            <button onClick={getAiHint} disabled={isHintLoading} className="text-blue-600 hover:text-blue-800 disabled:text-gray-400 text-sm font-semibold flex items-center justify-center gap-2 mx-auto">
                                <Sparkles size={16} className={isHintLoading ? 'animate-pulse' : ''}/>
                                {isHintLoading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±... / Thinking...' : 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­ Ø°ÙƒÙŠ / Get AI Hint'}
                            </button>
                            {showHint &&
                                <div className="mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm transition-all">
                                    {isHintLoading ? <p className="text-yellow-800 animate-pulse">...AI ÙŠÙˆÙ„Ø¯ ØªÙ„Ù…ÙŠØ­Ù‹Ø§ / AI is generating a hint...</p> :
                                     aiHint ? <p className="text-yellow-800">{`ğŸ’¡ ${aiHint}`}</p> :
                                     <p className="text-yellow-800">Ø§Ù†Ù‚Ø± ÙÙˆÙ‚ Ø§Ù„Ø²Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­ Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. / Click the button to get a hint from the AI.</p>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<LockPuzzleGame />, document.getElementById('root'));
    </script>
</body>
</html>

