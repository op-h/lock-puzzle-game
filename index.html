<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lock Puzzle Game</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' stroke-width='2' stroke='%233B82F6' fill='none' stroke-linecap='round' stroke-linejoin='round'><rect x='3' y='11' width='18' height='11' rx='2' ry='2'/><path d='M7 11V7a5 5 0 0 1 10 0v4'/></svg>">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <style>
        body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        @keyframes pulse { 50% { opacity: .5; } }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Firebase configuration is now hardcoded directly into the application.
        window.firebaseConfig = {
          apiKey: "AIzaSyAHXQMCBK6NdEdBO4-msM7M0Mm6x-cDxNY",
          authDomain: "lock-puzzle-game.firebaseapp.com",
          projectId: "lock-puzzle-game",
          storageBucket: "lock-puzzle-game.firebasestorage.app",
          messagingSenderId: "884071011603",
          appId: "1:884071011603:web:0a6cd0efaef45d3ba7f6e6",
          measurementId: "G-X5GHFKLZDD"
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- Icon Components ---
        const Lock = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const Check = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20,6 9,17 4,12"/></svg>;
        const X = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>;
        const RotateCcw = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const Shuffle = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="16,3 21,3 21,8"/><path d="M4 20 21 3"/><polyline points="21,16 21,21 16,21"/><path d="M15 15 21 21"/><path d="M4 4 9 9"/></svg>;
        const Trophy = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55.47.98.97 1.21C12.04 18.75 13 20.24 13 22"/><path d="M14 14.66V17c0 .55-.47.98-.97 1.21C11.96 18.75 11 20.24 11 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const User = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Lightbulb = ({ size = 24, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>;


        const LockPuzzleGame = () => {
            const [playerName, setPlayerName] = useState('');
            const [isNameSet, setIsNameSet] = useState(false);
            const [userGuess, setUserGuess] = useState(['', '', '']);
            const [attempts, setAttempts] = useState([]);
            const [isComplete, setIsComplete] = useState(false);
            const [showHint, setShowHint] = useState(false);
            const [currentPuzzle, setCurrentPuzzle] = useState(null);
            const [puzzleNumber, setPuzzleNumber] = useState(1);
            const [showLeaderboard, setShowLeaderboard] = useState(false);
            const [leaderboard, setLeaderboard] = useState([]);
            const [startTime, setStartTime] = useState(null);

            const [hintText, setHintText] = useState('');
            const [hintCount, setHintCount] = useState(0);
            const [hintUsedForScore, setHintUsedForScore] = useState(false);
            
            const [db, setDb] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [isOnlineMode, setIsOnlineMode] = useState(true);

            // --- Firebase Initialization and Auth ---
            useEffect(() => {
                try {
                    const config = window.firebaseConfig;

                    if (typeof config !== 'object' || !config.apiKey) {
                        throw new Error("Firebase config is not valid.");
                    }

                    if (!firebase.apps.length) {
                        firebase.initializeApp(config);
                    }
                    setDb(firebase.firestore());

                    const auth = firebase.auth();
                    const unsubscribe = auth.onAuthStateChanged(async (user) => {
                        if (!user) {
                           try {
                                await auth.signInAnonymously();
                            } catch (error) {
                                console.error("Firebase sign-in failed:", error);
                                setIsOnlineMode(false);
                            }
                        }
                        setIsAuthReady(true);
                    });
                    return () => unsubscribe();
                } catch (e) {
                    console.warn(`Could not initialize Firebase. Running in offline mode. Reason: ${e.message}`);
                    setIsOnlineMode(false);
                    setIsAuthReady(true);
                }
            }, []);

            // --- Real-time Leaderboard Listener ---
            useEffect(() => {
                if (!isAuthReady || !db || !isOnlineMode) return;
                
                const appId = 'lock-puzzle-game'; 
                const leaderboardPath = `artifacts/${appId}/public/data/leaderboard`;

                const unsubscribe = db.collection(leaderboardPath).onSnapshot(snapshot => {
                    const leaderboardData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const sortedLeaderboard = leaderboardData.sort((a, b) => (b.totalScore || 0) - (a.totalScore || 0)).slice(0, 20);
                    setLeaderboard(sortedLeaderboard);
                }, error => {
                    console.error("Error fetching leaderboard: ", error);
                });

                return () => unsubscribe();
            }, [isAuthReady, db, isOnlineMode]);

            // --- Game Logic ---
            const generateRandomAnswer = () => Array.from({length: 3}, () => Math.floor(Math.random() * 10).toString());
            const generateRandomCombination = (answer) => {
                let combo;
                do { combo = generateRandomAnswer(); } while (combo.join('') === answer.join(''));
                return combo;
            };
            const analyzeClue = (combination, answer) => {
                let correctPosition = 0;
                let correctDigitWrongPosition = 0;
                let usedAnswerIndices = [];
                let usedComboIndices = [];
                for (let i = 0; i < 3; i++) {
                    if (combination[i] === answer[i]) {
                        correctPosition++;
                        usedAnswerIndices.push(i);
                        usedComboIndices.push(i);
                    }
                }
                for (let i = 0; i < 3; i++) {
                    if (!usedComboIndices.includes(i)) {
                        for (let j = 0; j < 3; j++) {
                            if (!usedAnswerIndices.includes(j) && combination[i] === answer[j]) {
                                correctDigitWrongPosition++;
                                usedAnswerIndices.push(j);
                                break;
                            }
                        }
                    }
                }
                return { correctPosition, correctDigitWrongPosition };
            };
            const generateClueDescription = (analysis) => {
                const { correctPosition, correctDigitWrongPosition } = analysis;
                if (correctPosition === 0 && correctDigitWrongPosition === 0) return { hint: 'Ù„Ø§ Ø´ÙŠØ¡ ØµØ­ÙŠØ­', translation: 'Nothing is correct' };
                if (correctPosition === 1 && correctDigitWrongPosition === 0) return { hint: 'Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­ ÙˆÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­', translation: 'One digit correct and in right place' };
                if (correctPosition === 0 && correctDigitWrongPosition === 1) return { hint: 'Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­ ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'One digit correct but in wrong place' };
                if (correctPosition === 0 && correctDigitWrongPosition === 2) return { hint: 'Ø±Ù‚Ù…Ø§Ù† ØµØ­ÙŠØ­Ø§Ù† ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'Two digits correct but in wrong place' };
                if (correctPosition === 1 && correctDigitWrongPosition === 1) return { hint: 'Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­ ÙˆÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­ØŒ ÙˆØ±Ù‚Ù… Ø¢Ø®Ø± ØµØ­ÙŠØ­ ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'One correct and in right place, one correct but in wrong place' };
                if (correctPosition === 2 && correctDigitWrongPosition === 0) return { hint: 'Ø±Ù‚Ù…Ø§Ù† ØµØ­ÙŠØ­Ø§Ù† ÙˆÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­', translation: 'Two digits correct and in right place' };
                if (correctPosition === 0 && correctDigitWrongPosition === 3) return { hint: 'ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø© ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£', translation: 'All digits correct but in wrong places' };
                return { hint: 'ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ù‚Ø¯', translation: 'Complex analysis' };
            };
            const generatePuzzle = () => {
                const answer = generateRandomAnswer();
                const clues = [];
                const createdAnalyses = new Set();
                
                while (clues.length < 5) {
                    let combination = generateRandomCombination(answer);
                    let analysis = analyzeClue(combination, answer);
                    let analysisKey = `${analysis.correctPosition}-${analysis.correctDigitWrongPosition}`;

                    if (!createdAnalyses.has(analysisKey) || clues.length >= 4) { // Get more variety
                        const clueDesc = generateClueDescription(analysis);
                        clues.push({ digits: combination, hint: clueDesc.hint, translation: clueDesc.translation });
                        createdAnalyses.add(analysisKey);
                    }
                }
                return { answer: answer, clues: clues.sort(() => Math.random() - 0.5) }; // Shuffle clues
            };

            useEffect(() => {
                if (isNameSet && !currentPuzzle) {
                    setCurrentPuzzle(generatePuzzle());
                    setStartTime(Date.now());
                }
            }, [isNameSet, currentPuzzle]);

            // --- Game Actions ---
            const generateNewPuzzle = () => {
                setCurrentPuzzle(generatePuzzle());
                setPuzzleNumber(prev => prev + 1);
                setUserGuess(['', '', '']);
                setAttempts([]);
                setIsComplete(false);
                setShowHint(false);
                setHintText('');
                setHintCount(0);
                setHintUsedForScore(false);
                setStartTime(Date.now());
            };
            
            const calculatePuzzleScore = (attemptCount, timeInSeconds) => {
                const baseScore = 1000;
                const attemptPenalty = attemptCount * 50;
                const timePenalty = Math.floor(timeInSeconds / 10) * 5;
                const score = Math.max(100, baseScore - attemptPenalty - timePenalty);
                // If a hint was used, halve the score for this puzzle.
                return hintUsedForScore ? Math.floor(score / 2) : score;
            };

            const addToLeaderboard = async (puzzleScore, timeInSeconds) => {
                if (!db || !isOnlineMode) return;
                const appId = 'lock-puzzle-game';
                const leaderboardRef = db.collection(`artifacts/${appId}/public/data/leaderboard`);

                try {
                    // Query for an existing player with the same name
                    const querySnapshot = await leaderboardRef.where("name", "==", playerName).limit(1).get();

                    if (!querySnapshot.empty) {
                        // Player exists, update their document
                        const playerDoc = querySnapshot.docs[0];
                        const playerData = playerDoc.data();
                        
                        await playerDoc.ref.update({
                            totalScore: (playerData.totalScore || 0) + puzzleScore,
                            puzzlesSolved: (playerData.puzzlesSolved || 0) + 1,
                            totalTime: (playerData.totalTime || 0) + timeInSeconds,
                            lastPlayed: new Date().toISOString()
                        });
                    } else {
                        // Player does not exist, create a new entry
                        const newEntry = {
                            name: playerName,
                            totalScore: puzzleScore,
                            puzzlesSolved: 1,
                            totalTime: timeInSeconds,
                            lastPlayed: new Date().toISOString()
                        };
                        await leaderboardRef.add(newEntry);
                    }
                } catch (error) {
                    console.error("Error updating leaderboard:", error);
                }
            };
            
            const handleDigitChange = (index, value) => {
                if (value.length <= 1 && /^[0-9]*$/.test(value)) {
                    const newGuess = [...userGuess];
                    newGuess[index] = value;
                    setUserGuess(newGuess);
                }
            };

            const checkAnswer = () => {
                if (!currentPuzzle || userGuess.some(digit => digit === '')) return;
                const isCorrect = userGuess.join('') === currentPuzzle.answer.join('');
                
                const newAttempt = { guess: [...userGuess], correct: isCorrect, timestamp: new Date().toLocaleTimeString() };
                const updatedAttempts = [...attempts, newAttempt];
                setAttempts(updatedAttempts);
                
                if (isCorrect) {
                    setIsComplete(true);
                    const timeInSeconds = Math.floor((Date.now() - startTime) / 1000);
                    const score = calculatePuzzleScore(updatedAttempts.length, timeInSeconds);
                    addToLeaderboard(score, timeInSeconds);
                }
            };

            const resetGame = () => {
                setUserGuess(['', '', '']);
                setAttempts([]);
                setIsComplete(false);
                setShowHint(false);
                setHintText('');
                setStartTime(Date.now());
            };

            const handleNameSubmit = (e) => {
                e.preventDefault();
                if (playerName.trim()) {
                    setIsNameSet(true);
                }
            };

            // --- Simple Hint Generation with Penalty ---
            const handleHintToggle = () => {
                // If the hint is already visible, just hide it.
                if (showHint) {
                    setShowHint(false);
                    return;
                }

                // If no hints are left, show a message and do nothing else.
                if (hintCount >= 1) {
                    setHintText("Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ¯Øª ØªÙ„Ù…ÙŠØ­Ùƒ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ². / You have used your hint for this puzzle.");
                    setShowHint(true);
                    return;
                }

                // Generate and show hint, applying penalties.
                setShowHint(true);
                setHintUsedForScore(true); // Apply score penalty.
                setHintCount(prev => prev + 1); // Use up the hint.

                const hintPositionIndex = Math.floor(Math.random() * 3);
                const hintDigit = currentPuzzle.answer[hintPositionIndex];
                const positionWordArabic = ['Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø«'][hintPositionIndex];
                const positionWordEnglish = ['first', 'second', 'third'][hintPositionIndex];

                const hint = `Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù€${positionWordArabic} Ù‡Ùˆ ${hintDigit}. / The digit in the ${positionWordEnglish} position is ${hintDigit}.`;
                
                setHintText(hint);
            };
            
            // --- UI Rendering ---
            if (!isAuthReady) {
                 return <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4 text-white text-xl">Loading Game...</div>;
            }

            if (!isNameSet) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
                            <div className="flex justify-center mb-6"><div className="bg-slate-700 p-4 rounded-full"><User size={48} className="text-white" /></div></div>
                            <h1 className="text-2xl font-bold text-slate-800 mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚ÙÙ„</h1>
                            <p className="text-slate-600 mb-6">Welcome to Lock Puzzle Game</p>
                            <form onSubmit={handleNameSubmit}>
                                <input type="text" value={playerName} onChange={(e) => setPlayerName(e.target.value)} placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ / Enter your name" className="w-full px-4 py-3 text-center border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none mb-4 text-lg" maxLength="20" />
                                <button type="submit" disabled={!playerName.trim()} className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-3 rounded-lg font-semibold text-lg transition-colors">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ / Start Playing</button>
                            </form>
                            <button onClick={() => setShowLeaderboard(true)} className="mt-4 text-blue-600 hover:text-blue-800 text-sm underline flex items-center justify-center gap-2 mx-auto disabled:text-gray-400 disabled:cursor-not-allowed" disabled={!isOnlineMode}>
                                <Trophy size={16} />
                                {isOnlineMode ? 'Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† / View Leaderboard' : 'Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† (ØºÙŠØ± Ù…ØªØµÙ„) / Leaderboard (Offline)'}
                            </button>
                        </div>
                    </div>
                );
            }

            if (showLeaderboard) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full">
                            <div className="text-center mb-6">
                                <div className="flex justify-center mb-4"><div className="bg-yellow-500 p-4 rounded-full"><Trophy size={48} className="text-white" /></div></div>
                                <h1 className="text-2xl font-bold text-slate-800 mb-2">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† / Leaderboard</h1>
                            </div>
                            <div className="max-h-96 overflow-y-auto mb-6">
                                {leaderboard.length === 0 ? <p className="text-center text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯ / No results yet</p> :
                                    leaderboard.map((entry, index) => (
                                        <div key={entry.id} className={`flex items-center justify-between p-3 rounded-lg mb-2 ${index < 3 ? 'bg-gradient-to-r from-yellow-50 to-yellow-100 border-2 border-yellow-200' : 'bg-slate-50'}`}>
                                            <div className="flex items-center gap-3">
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold ${index === 0 ? 'bg-yellow-500' : index === 1 ? 'bg-gray-400' : index === 2 ? 'bg-yellow-600' : 'bg-slate-400'}`}>{index + 1}</div>
                                                <div>
                                                    <p className="font-semibold text-slate-800">{entry.name}</p>
                                                    <p className="text-xs text-slate-500">{`Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©: ${entry.puzzlesSolved || 0} | Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${entry.totalTime || 0}Ø«`}</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-bold text-lg text-blue-600">{entry.totalScore || 0}</p>
                                                <p className="text-xs text-slate-500">{entry.lastPlayed ? new Date(entry.lastPlayed).toLocaleString() : 'N/A'}</p>
                                            </div>
                                        </div>
                                    ))
                                }
                            </div>
                            <button onClick={() => setShowLeaderboard(false)} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø© / Back to Game</button>
                        </div>
                    </div>
                );
            }

            if (!currentPuzzle) {
                return <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center"><div className="text-white text-xl">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù„ØºØ²... / Loading puzzle...</div></div>;
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <div className="text-center mb-8">
                            <div className="flex justify-center mb-4"><div className="bg-slate-700 p-4 rounded-full"><Lock size={48} className="text-white" /></div></div>
                            <h1 className="text-2xl font-bold text-slate-800 mb-2">Ù‡Ù„ ØªØ³ØªØ·ÙŠØ¹ ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ØŸ</h1>
                            <p className="text-slate-600">Can you open the lock?</p>
                            <div className="bg-blue-50 rounded-lg p-2 mt-3">
                                <p className="text-blue-800 font-semibold">{`ğŸ® Ø§Ù„Ù„Ø§Ø¹Ø¨: ${playerName} | Player: ${playerName}`}</p>
                                <p className="text-blue-600 text-sm">{`Ù„ØºØ² Ø±Ù‚Ù… ${puzzleNumber} | Puzzle #${puzzleNumber}`}</p>
                            </div>
                        </div>

                        <div className="mb-6">
                            <div className="flex justify-center gap-4 mb-4">
                                {userGuess.map((digit, index) => <input key={index} type="text" value={digit} onChange={(e) => handleDigitChange(index, e.target.value)} className="w-16 h-16 text-2xl font-bold text-center border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none" maxLength="1" disabled={isComplete} />)}
                            </div>
                            <div className="flex gap-2 justify-center flex-wrap">
                                <button onClick={checkAnswer} disabled={userGuess.some(d => d === '') || isComplete} className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg font-semibold transition-colors">ØªØ­Ù‚Ù‚ / Check</button>
                                <button onClick={resetGame} className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors"><RotateCcw size={20} /></button>
                                <button onClick={generateNewPuzzle} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2"><Shuffle size={16} /><span className="text-sm">Ù„ØºØ² Ø¬Ø¯ÙŠØ¯</span></button>
                                <button onClick={() => setShowLeaderboard(true)} className="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled={!isOnlineMode}>
                                    <Trophy size={16} />
                                    <span className="text-sm">{isOnlineMode ? 'Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†' : 'ØºÙŠØ± Ù…ØªØµÙ„'}</span>
                                </button>
                            </div>
                        </div>

                        {isComplete &&
                            <div className="bg-green-100 border-2 border-green-400 rounded-lg p-4 mb-6 text-center">
                                <Check className="mx-auto mb-2 text-green-600" size={32} />
                                <p className="text-green-800 font-bold">ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙØªØ­Øª Ø§Ù„Ù‚ÙÙ„!</p>
                                <p className="text-green-700">Congratulations! You opened the lock!</p>
                                <p className="text-green-600 text-sm mt-2">{`Ø§Ù„Ø¬ÙˆØ§Ø¨ ÙƒØ§Ù†: ${currentPuzzle.answer.join('')} / Answer was: ${currentPuzzle.answer.join('')}`}</p>
                                <p className="text-blue-600 text-sm mt-1 font-semibold">{`Ù†Ù‚Ø§Ø· Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ²: ${calculatePuzzleScore(attempts.length, Math.floor((Date.now() - startTime) / 1000))}`}</p>
                            </div>
                        }

                        <div className="mb-6">
                            <h3 className="text-lg font-bold text-slate-800 mb-4 text-center">Ø§Ù„Ù‚Ø±Ø§Ø¦Ù† / Clues</h3>
                            <div className="space-y-3">
                                {currentPuzzle.clues.map((clue, index) =>
                                    <div key={index} className="bg-slate-50 rounded-lg p-3">
                                        <div className="flex justify-center gap-2 mb-2">
                                            {clue.digits.map((digit, i) => <div key={i} className="w-10 h-10 bg-white border-2 border-slate-300 rounded flex items-center justify-center font-bold text-slate-700">{digit}</div>)}
                                        </div>
                                        <p className="text-sm text-slate-600 text-center font-semibold">{clue.hint}</p>
                                        <p className="text-xs text-slate-500 text-center">{clue.translation}</p>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        {attempts.length > 0 &&
                            <div className="mb-4">
                                <h3 className="text-lg font-bold text-slate-800 mb-2">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª / Attempts</h3>
                                <div className="space-y-2 max-h-32 overflow-y-auto p-2 bg-gray-50 rounded-md">
                                    {attempts.slice().reverse().map((attempt, index) =>
                                        <div key={index} className="flex items-center justify-between text-sm">
                                            <div className="flex items-center gap-2">
                                               <span className="text-xs text-gray-400">#{attempts.length - index}</span>
                                               <div className="flex gap-1 font-mono tracking-widest">{attempt.guess.join('')}</div>
                                               {attempt.correct ? <Check size={16} className="text-green-600" /> : <X size={16} className="text-red-600" />}
                                            </div>
                                            <span className="text-slate-500 text-xs">{attempt.timestamp}</span>
                                        </div>
                                    )}
                                </div>
                            </div>
                        }
                        
                        <div className="text-center border-t pt-4 mt-4">
                             {hintCount < 1 ? (
                                <p className="text-sm text-slate-500 mb-2">
                                    ØªÙ„Ù…ÙŠØ­ ÙˆØ§Ø­Ø¯ Ù…ØªØ§Ø­ (ÙŠØ®ØµÙ… 50% Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø·). / 1 hint available (costs 50% of score).
                                </p>
                            ) : (
                                <p className="text-sm text-red-500 mb-2">
                                    Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª ØªÙ„Ù…ÙŠØ­Ùƒ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ². / You have used your hint for this puzzle.
                                </p>
                            )}
                            <button 
                                onClick={handleHintToggle} 
                                disabled={isComplete || (hintCount >= 1 && !showHint)}
                                className="text-blue-600 hover:text-blue-800 text-sm font-semibold flex items-center justify-center gap-2 mx-auto disabled:text-gray-400 disabled:cursor-not-allowed">
                                <Lightbulb size={16} />
                                {showHint ? 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ„Ù…ÙŠØ­ / Hide Hint' : 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­ / Get Hint'}
                            </button>
                            {showHint && hintText &&
                                <div className="mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm transition-all">
                                    <p className="text-yellow-800">{`ğŸ’¡ ${hintText}`}</p>
                                    {hintUsedForScore && <p className="text-red-600 text-xs mt-1 font-semibold">ØªÙ… Ø®ØµÙ… 50% Ù…Ù† Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ². / 50% of your final score for this puzzle has been deducted.</p>}
                                </div>
                            }
                        </div>
                    </div>
                </div>
            );
        };
        ReactDOM.render(<LockPuzzleGame />, document.getElementById('root'));
    </script>
</body>
</html>

